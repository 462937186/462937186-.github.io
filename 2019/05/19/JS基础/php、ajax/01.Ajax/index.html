<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/logo.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/logo.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/logo.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.png?v=5.1.4" color="#222">





  <meta name="keywords" content="JS,AJAX,">










<meta name="description" content="Ajax了解AJAX AJAX: Asynchronous Javascript And Xml，Ajax 技术的核心是XMLHttpRequest对象（简称XHR），这是由微软首先引入的一个特性，其他浏览器提供商后来都提供了相同的实现  *Ajax起源：最早出现在2005年的google搜索建议  ajax优点 增加速度：减轻服务器的负担,按需加载数据,最大程度的减少冗余请求 改善的用户体验：局">
<meta name="keywords" content="JS,AJAX">
<meta property="og:type" content="article">
<meta property="og:title" content="Ajax简介">
<meta property="og:url" content="https://462937186.github.io/2019/05/19/JS基础/php、ajax/01.Ajax/index.html">
<meta property="og:site_name" content="个人博客">
<meta property="og:description" content="Ajax了解AJAX AJAX: Asynchronous Javascript And Xml，Ajax 技术的核心是XMLHttpRequest对象（简称XHR），这是由微软首先引入的一个特性，其他浏览器提供商后来都提供了相同的实现  *Ajax起源：最早出现在2005年的google搜索建议  ajax优点 增加速度：减轻服务器的负担,按需加载数据,最大程度的减少冗余请求 改善的用户体验：局">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2019-05-19T04:26:02.476Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Ajax简介">
<meta name="twitter:description" content="Ajax了解AJAX AJAX: Asynchronous Javascript And Xml，Ajax 技术的核心是XMLHttpRequest对象（简称XHR），这是由微软首先引入的一个特性，其他浏览器提供商后来都提供了相同的实现  *Ajax起源：最早出现在2005年的google搜索建议  ajax优点 增加速度：减轻服务器的负担,按需加载数据,最大程度的减少冗余请求 改善的用户体验：局">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://462937186.github.io/2019/05/19/JS基础/php、ajax/01.Ajax/">





  <title>Ajax简介 | 个人博客</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>
    <a href="https://your-url" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">个人博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://462937186.github.io/2019/05/19/JS基础/php、ajax/01.Ajax/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Admin">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/favicon.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Ajax简介</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-05-19T12:23:54+08:00">
                2019-05-19
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/js基础/" itemprop="url" rel="index">
                    <span itemprop="name">JS基础</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="Ajax"><a href="#Ajax" class="headerlink" title="Ajax"></a>Ajax</h1><h2 id="了解AJAX"><a href="#了解AJAX" class="headerlink" title="了解AJAX"></a>了解AJAX</h2><ul>
<li>AJAX: Asynchronous Javascript And Xml，Ajax 技术的核心是XMLHttpRequest对象（简称XHR），这是由微软首先引入的一个特性，其他浏览器提供商后来都提供了相同的实现</li>
</ul>
<p>*Ajax起源：<br>最早出现在2005年的google搜索建议</p>
<ul>
<li>ajax优点<ul>
<li>增加速度：减轻服务器的负担,按需加载数据,最大程度的减少冗余请求</li>
<li>改善的用户体验：局部刷新页面,减少用户等待时间,带来更好的用户体验</li>
<li>页面和数据分离：前后端分离，操作更灵活，后期维护更方便</li>
</ul>
</li>
<li>后端语言和服务器配置<ul>
<li>php + Apache + mySQL</li>
<li>NodeJS + MongoDB</li>
<li>Java + tomcat + Oracle</li>
<li>.NET + IIS + SQL Server</li>
</ul>
</li>
</ul>
<h2 id="json"><a href="#json" class="headerlink" title="json"></a>json</h2><h4 id="json数据-json字符串"><a href="#json数据-json字符串" class="headerlink" title="json数据(json字符串)"></a>json数据(json字符串)</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;id&quot; : 21465461461461, &quot;name&quot;: &quot;张三&quot;&#125;,[&#123;&quot;id&quot; : 21465461461461, &quot;name&quot;: &quot;张三&quot;&#125;]</span><br></pre></td></tr></table></figure>
<h4 id="json字符串与对象的转换"><a href="#json字符串与对象的转换" class="headerlink" title="json字符串与对象的转换"></a>json字符串与对象的转换</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//（一）json字符串转成对象的转换</span><br><span class="line">//1. eval(&quot;(&quot;+json字符串+&quot;)&quot;); </span><br><span class="line">它的作用是，将一个普通的json格式的字符串，转换成Json格式的对象</span><br><span class="line">//var list = eval(&quot;(&quot;+request.responseText+&quot;)&quot;);</span><br><span class="line">//2. JSON.parse(); //把JSON字符串转成JSON对象(js对象/数组)【es5】</span><br><span class="line"></span><br><span class="line">//（二）把JSON对象转成JSON字符串</span><br><span class="line">JSON.stringify();</span><br></pre></td></tr></table></figure>
<h4 id="了解json文件存在的意义"><a href="#了解json文件存在的意义" class="headerlink" title="了解json文件存在的意义"></a>了解json文件存在的意义</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//模拟数据(与后端先商量)</span><br><span class="line">[</span><br><span class="line">	&#123;</span><br><span class="line">		&quot;id&quot;:&quot;G001&quot;,</span><br><span class="line">		&quot;name&quot;:&quot;Thermos 膳魔师 Funtainer系列水杯 12盎司（340g） 粉红色&quot;,</span><br><span class="line">		&quot;imgurl&quot;:&quot;images/g1.jpg&quot;,</span><br><span class="line">		&quot;price&quot;:899,</span><br><span class="line">	&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h2 id="Ajax请求步骤"><a href="#Ajax请求步骤" class="headerlink" title="Ajax请求步骤"></a>Ajax请求步骤</h2><h4 id="创建请求对象-返回一个异步请求对象"><a href="#创建请求对象-返回一个异步请求对象" class="headerlink" title="创建请求对象,返回一个异步请求对象"></a>创建请求对象,返回一个异步请求对象</h4><p><code>var xhr = new XMLHttpRequest();</code></p>
<h4 id="处理服务器返回数据"><a href="#处理服务器返回数据" class="headerlink" title="处理服务器返回数据"></a>处理服务器返回数据</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">xhr.onreadystatechange = function()&#123;</span><br><span class="line">    if(xhr.readyState == 4) &#123;</span><br><span class="line">        //responseText：保存服务器返回的数据（从服务器返回的数据是“字符串”）。</span><br><span class="line">        alert(xhr.responseText);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="设置请求参数，建立与服务器连接"><a href="#设置请求参数，建立与服务器连接" class="headerlink" title="设置请求参数，建立与服务器连接"></a>设置请求参数，建立与服务器连接</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xhr.open(&quot;get&quot;, &quot;http://localhost/api/ajaxtest&quot;, true);</span><br></pre></td></tr></table></figure>
<h4 id="向服务器发送请求"><a href="#向服务器发送请求" class="headerlink" title="向服务器发送请求"></a>向服务器发送请求</h4><p><code>xhr.send(null);</code></p>
<h6 id="案例：演示向goodslist-json请求数据"><a href="#案例：演示向goodslist-json请求数据" class="headerlink" title="案例：演示向goodslist.json请求数据"></a>案例：演示向goodslist.json请求数据</h6><h2 id="XMLHttpRequest对象属性方法"><a href="#XMLHttpRequest对象属性方法" class="headerlink" title="XMLHttpRequest对象属性方法"></a>XMLHttpRequest对象属性方法</h2><h4 id="open-type-url（同源策略）-async（同步、异步）"><a href="#open-type-url（同源策略）-async（同步、异步）" class="headerlink" title="open(type,url（同源策略）,async（同步、异步）)"></a>open(type,url（同源策略）,async（同步、异步）)</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1.open(type,url,async): 建立与服务器的连接</span><br><span class="line">    type：请求的类型，get、post</span><br><span class="line">    	* 区别? </span><br><span class="line">    		get请求数据接在url后面，post请求数据通过send方法传递</span><br><span class="line">    		get传递的数据会比较少</span><br><span class="line">    		get传递的数据会暴露出来</span><br><span class="line">    url：数据请求的地址（API地址），一般由后端开发人员提供</span><br><span class="line">        * 当前页面访问地址，API地址两者一定要同域</span><br><span class="line">        * 同域（同源策略）：协议，域名，端口三者一致</span><br><span class="line">        * 报错： No &apos;Access-Control-Allow-Origin&apos; header is present on the requested resource. Origin &apos;null&apos; is therefore not allowed access.</span><br><span class="line">	async：是否异步发送请求（true,false），默认为true</span><br><span class="line">        * 同步：按步骤顺序执行，前面的代码执行完后，后面的代码才会执行</span><br><span class="line">        	做完前一件事情, 才能下一件事情（排队）</span><br><span class="line">        * 异步：与其他操作同时执行，也叫并发（图片加载，ajax请求，定时器）</span><br></pre></td></tr></table></figure>
<h4 id="send-data"><a href="#send-data" class="headerlink" title="send(data)"></a>send(data)</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">2.send(data): 向服务器发送请求</span><br><span class="line">	data：可选参数，post请求时才生效，表示发请求时传送的数据字符串。</span><br><span class="line">    	 xhr.send(&apos;size=20&amp;type=music&apos;);</span><br><span class="line">		在某些浏览器中，如果不需要通过post请求主体发送数据，则必须传入null</span><br><span class="line">//备注：get请求的数据写在url地址后</span><br><span class="line">	request.open(&quot;get&quot;, &quot;http://localhost/api/getdata.php?type=get&amp;qty=10&quot;, true);</span><br><span class="line">	setRequestHeader(key,val)：设置请求头</span><br><span class="line">//备注：利用请求头设置POST提交数据格式：</span><br><span class="line">	xhr.setRequestHeader(‘content-type’,”application/x-www-form-urlencoded”)；//open方法后设置</span><br></pre></td></tr></table></figure>
<blockquote>
<p>**在请求收到服务器的响应后，响应的数据会自动填充xhr 对象的属性，相关的属性简介如下：</p>
</blockquote>
<h4 id="readyState"><a href="#readyState" class="headerlink" title="readyState"></a>readyState</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">0 － （未初始化）尚未调用open()方法。</span><br><span class="line">1 － （启动）已经调用open()方法，但尚未调用send()方法。</span><br><span class="line">2 － （发送）send()方法执行完成，但尚未接收到响应。</span><br><span class="line">3 － （接收）已经接收到部分响应数据。</span><br><span class="line">4 － （完成）响应内容解析完成，可以在客户端调用了</span><br><span class="line">只要readyState 属性的值由一个值变成另一个值，都会触发一次readystatechange 事件。必须在调用open()之前指定onreadystatechange事件处理程序才能确保跨浏览器兼容性。</span><br></pre></td></tr></table></figure>
<h4 id="responseText"><a href="#responseText" class="headerlink" title="responseText"></a>responseText</h4><pre><code>保存服务器返回的数据（从服务器返回的数据是“字符串”）。
</code></pre><h4 id="status"><a href="#status" class="headerlink" title="status"></a>status</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">* 响应的HTTP 状态。</span><br><span class="line">200（OK）：服务器成功返回了页面</span><br><span class="line">304（Not Modified）：数据与服务器相同，不需要重服务器请求（直接使用缓存的数据）</span><br><span class="line">400（Bad Request）：语法错误导致服务器不识别</span><br><span class="line">401（Unauthorized）：请求需要用户认证</span><br><span class="line">404（Not found）：请求地址不存在</span><br><span class="line">500（Internal Server Error）：服务器出错或无响应</span><br><span class="line">503（ServiceUnavailable）：由于服务器过载或维护导致无法完</span><br></pre></td></tr></table></figure>
<h1 id="php本地数据操作"><a href="#php本地数据操作" class="headerlink" title="php本地数据操作"></a>php本地数据操作</h1><h4 id="获取前端数据"><a href="#获取前端数据" class="headerlink" title="获取前端数据"></a>获取前端数据</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$_GET 获取前端用get方式传递过来的数据（url地址后面数据也能被获取）</span><br><span class="line">$_POST	获取前端用get方式传递过来的数据</span><br><span class="line">isset() 判断某个值是否被设置，若不存在返回boolean</span><br></pre></td></tr></table></figure>
<h4 id="文件的读取与写入"><a href="#文件的读取与写入" class="headerlink" title="文件的读取与写入"></a>文件的读取与写入</h4><h5 id="fopen-path-mode-：打开文件"><a href="#fopen-path-mode-：打开文件" class="headerlink" title="fopen(path,mode)：打开文件"></a>fopen(path,mode)：打开文件</h5><blockquote>
<p>使用fopen函数打开文件时，你首先需要明确打开文件的模式：<br>1.将数据写入文件，亦或者读写文件<br>2.考虑如果文件中已经存在相关数据，你是覆盖原有文件中的数据呢，还是仅仅将新数据添加至文件末尾</p>
</blockquote>
<blockquote>
<p>文件模式:</p>
<ul>
<li>r 以只读方式打开文件，从文件头开始读</li>
<li>r+ 以读写方式打开文件，写入时以追加的方式写入文件</li>
<li>w 以写入方式打开文件，从文件头开始写。文件不存在则尝试创建，若存在，则先删除文件中的内容</li>
<li>w+ 以读写方式打开文件，从文件头开始读写。文件不存在则尝试创建，若存在，则先删除文件中的内容</li>
<li>a 以写入方式打开，从文件末尾开始追加写。如果文件不存在则尝试创建</li>
<li>a+ 以读写方式打开，从文件末尾开始追加写入或者读。如果文件不存在则尝试创建。</li>
</ul>
</blockquote>
<h5 id="fread-file-length-：读取内容"><a href="#fread-file-length-：读取内容" class="headerlink" title="fread(file,length)：读取内容"></a>fread(file,length)：读取内容</h5><h5 id="fwrite-file-json字符串-：写入内容"><a href="#fwrite-file-json字符串-：写入内容" class="headerlink" title="fwrite(file,json字符串)：写入内容"></a>fwrite(file,json字符串)：写入内容</h5><h5 id="fclose-file-：关闭文件-避免资源占用"><a href="#fclose-file-：关闭文件-避免资源占用" class="headerlink" title="fclose(file)：关闭文件,避免资源占用"></a>fclose(file)：关闭文件,避免资源占用</h5><h5 id="filesize-path-：读取文件字符长度"><a href="#filesize-path-：读取文件字符长度" class="headerlink" title="filesize(path)：读取文件字符长度"></a>filesize(path)：读取文件字符长度</h5><pre><code>//1.以读取模式打开文件
$path = &apos;./data/weibo.json&apos;
$myfile = fopen($path, &apos;r&apos;);

//2.读取文件内容
$content = fread($myfile, filesize($path));

//3.关闭文件，减少资源占用
fclose($myfile);
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">echo返回数据</span><br><span class="line">json_encode(); 把数组转成字符串</span><br><span class="line">	php5.4+ 使用JSON_UNESCAPED_UNICODE防止中文转义</span><br><span class="line">json_decode(json,assoc); 把字符串转成数组/对象</span><br><span class="line">	json：待解码的 json string 格式的字符串</span><br><span class="line">	assoc：默认false,返回嵌套对象的多维数组，通过arr-&gt;key获取对象键对应的值。当该参数为 true 时，将返回嵌套关联数组的多维数组，通过arr[key]获取关联数组键对应的值。</span><br></pre></td></tr></table></figure>
<h6 id="案例：微博点赞"><a href="#案例：微博点赞" class="headerlink" title="案例：微博点赞"></a>案例：微博点赞</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">//（html页面）1.发起ajax请求，将weibo.json的内容返回到页面</span><br><span class="line">var xhr = new XMLHttpRequest();</span><br><span class="line">xhr.onreadystatechange = function()&#123;</span><br><span class="line">    if(xhr.readyState === 4 &amp;&amp; xhr.status === 200)&#123;</span><br><span class="line">        var res = JSON.parse(xhr.responseText);</span><br><span class="line">        ul.innerHTML = res.map(item=&gt;&#123;</span><br><span class="line">            return `&lt;li data-id=&quot;$&#123;item.id&#125;&quot;&gt;</span><br><span class="line">            &lt;h4&gt;$&#123;item.username&#125;&lt;/h4&gt;</span><br><span class="line">            &lt;p&gt;$&#123;item.content&#125;&lt;/p&gt;</span><br><span class="line">            &lt;span&gt;$&#123;item.comtcnt&#125;&lt;/span&gt;</span><br><span class="line">            &lt;span class=&quot;like&quot;&gt;$&#123;item.likecnt&#125;&lt;/span&gt;</span><br><span class="line">            &lt;/li&gt;`;</span><br><span class="line">    	&#125;).join(&apos;&apos;);</span><br><span class="line">    	datalist.appendChild(ul);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">xhr.open(&apos;get&apos;,&apos;../data/weibo.json&apos;,true);</span><br><span class="line">xhr.send();</span><br><span class="line">//(html页面)2.点赞，获取到当前按钮对用的id，发送ajax请求，get方法通过url拼接参数传送id到后台。</span><br><span class="line">//随后php页面对json数据进行修改，再将当前被改变的对象返回。xhr对象通过responseText进行接收为字符串，转成对象，获取到linkcnt键对应的值，给当前事件源修改innerHTML。</span><br><span class="line">//考虑多次请求，可能存在缓存状态，所以补充若是status为304也为请求成功。</span><br><span class="line">datalist.onclick = function(e)&#123;</span><br><span class="line">    if(e.target.className === &apos;like&apos;)&#123;</span><br><span class="line">        // e.target.innerText = e.target.innerText*1+1;</span><br><span class="line">        // 获取当前微博id</span><br><span class="line">        let currentLi = e.target.parentNode;</span><br><span class="line">        let id = currentLi.dataset.id;</span><br><span class="line">        let xhr = new XMLHttpRequest();</span><br><span class="line">        let status = [200,304];</span><br><span class="line">        xhr.onreadystatechange = function()&#123;</span><br><span class="line">            if(xhr.readyState === 4 &amp;&amp; status.indexOf(xhr.status)&gt;=0)&#123;</span><br><span class="line">                let res = JSON.parse(xhr.responseText);</span><br><span class="line">                e.target.innerHTML = res.likecnt;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        xhr.open(&apos;get&apos;,&apos;../api/weibo.php?id=&apos;+id,true);</span><br><span class="line">        xhr.send();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">//（php）</span><br><span class="line">//1.接收前端传过来的id，返回值为字符串</span><br><span class="line">$id = isset($_GET[&apos;id&apos;]) ? $_GET[&apos;id&apos;] : Null;</span><br><span class="line">//2.打开json文件fopen()，读取json文件数据fread()。</span><br><span class="line">$path = &apos;&apos;;//相对路径</span><br><span class="line">$file = fopen($path,&quot;r&quot;);</span><br><span class="line">$content = fread($file,filesize($path));</span><br><span class="line">fclose($file);</span><br><span class="line">//2.对得到的content内容转成json数组后，遍历里面每个item对象，若id键对应的值等于传入的$id,将该对象的linkcnt++。</span><br><span class="line">$contentArr = json.decode($content);//此处contentArr为对象数组</span><br><span class="line">$res;</span><br><span class="line">foreach($contentArr as $item)&#123;</span><br><span class="line">    //此处item为一个对象</span><br><span class="line">    if($item-&gt;id == $id)&#123;</span><br><span class="line">        $item-&gt;linkcnt++;</span><br><span class="line">        $res = $item;</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line">//4.将contentArr转成字符串，重新写入json文件</span><br><span class="line">$file = fopen($path, &apos;w&apos;);</span><br><span class="line">fwrite($file, json_encode($arr,JSON_UNESCAPED_UNICODE));</span><br><span class="line">fclose($file);</span><br><span class="line">//5.将步骤2声明变量res，将改变的item对象用res接收，转成字符串，echo给前端</span><br><span class="line">echo json_encode($res,JSON_UNESCAPED_UNICODE);</span><br></pre></td></tr></table></figure>
<h6 id="补充：eval的使用"><a href="#补充：eval的使用" class="headerlink" title="补充：eval的使用"></a>补充：eval的使用</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var json = &apos;&#123;&quot;name&quot;:&quot;lemon&quot;,&quot;age&quot;:18&#125;&apos;; //标准json字符串</span><br><span class="line">var json = &apos;&#123;&quot;name&quot;:&quot;lemon&quot;,\&apos;age\&apos;:18&#125;&apos;;//不标准</span><br><span class="line">eval(&apos;(&apos;+json+&apos;)&apos;);//也可以转成对象</span><br><span class="line">eval(&apos;1+2&apos;);//3</span><br><span class="line">eval(&apos;定义函数；执行函数&apos;) //函数可以在字符串中执行</span><br></pre></td></tr></table></figure>
<h6 id="讲解：ajax的来历及同源策略、同步异步"><a href="#讲解：ajax的来历及同源策略、同步异步" class="headerlink" title="讲解：ajax的来历及同源策略、同步异步"></a>讲解：ajax的来历及同源策略、同步异步</h6><h6 id="案例：用户名验证"><a href="#案例：用户名验证" class="headerlink" title="案例：用户名验证"></a>案例：用户名验证</h6><pre><code>username.onblur = function(){
    let _username = username.value;
    let status = [200,304];
    let xhr = new XMLHttpRequest();
    //xhr.onload意思为数据请求完成后，等同于xhr.readystate==4的状态
    xhr.onload = function(){
        if(status.includes(xhr.status)){
            let res = xhr.responseText;//fail,success
            if(res === &apos;fail&apos;){
                username.nextElementSibling.innerHTML = `${_username}太受欢迎，你走吧`；
            }else{
                username.nextElementSibling.innerHTML = `恭喜你绿了`；
            }
        }
    }
    xhr.open(&apos;get&apos;,&apos;../api/checkname.php?username=&apos;+_username,true);
    xhr.send();
}
//php
//1.数组存放已经存在的用户名
$userlist = array(&apos;张三&apos;,&apos;李四&apos;,&apos;王尼玛&apos;,&apos;奥巴马&apos;,&apos;laoxie&apos;,&apos;lemon&apos;);
//2. 获取前端传来的用户名
$username = isset($_GET[&apos;username&apos;]) ? $_GET[&apos;username&apos;] : null;
//3. 判断前端传来的用户名是否已存在数组内
$res = in_array($username, $userlist);
if($res){
    // 用户名已存在，注册失败
    echo &quot;fail&quot;;
}else{
    echo &quot;success&quot;;
}
</code></pre><h6 id="案例：分页数据加载"><a href="#案例：分页数据加载" class="headerlink" title="案例：分页数据加载"></a>案例：分页数据加载</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">//html页面：</span><br><span class="line">var qty = 5;</span><br><span class="line">// 1.发起ajax请求数据，拿到返回的数据，转成对象。</span><br><span class="line">let status = [200,304]</span><br><span class="line">let xhr = new XMLHttpRequest();</span><br><span class="line">xhr.onload = function()&#123;</span><br><span class="line">    if(status.includes(xhr.status))&#123;</span><br><span class="line">        let res = JSON.parse(xhr.responseText);</span><br><span class="line">        // 2.拿到对象的data键对应的值(为json字符串)，渲染页面</span><br><span class="line">        datalist.innerHTML= res.data.map(function(item)&#123;</span><br><span class="line">            return `&lt;li&gt;</span><br><span class="line">            &lt;h4&gt;$&#123;item.name&#125;&lt;/h4&gt;</span><br><span class="line">            &lt;div&gt;$&#123;item.content&#125;&lt;/div&gt;</span><br><span class="line">            &lt;/li&gt;`;</span><br><span class="line">        &#125;).join(&quot;&quot;);</span><br><span class="line">        //3.得到总页码数pageNum，parseInt(数据总数res.total/每页数据qty).遍历生成页码</span><br><span class="line">        var pageNum = parseInt(res.total/res.qty);</span><br><span class="line">        page.innerHTML = &quot;&quot;;</span><br><span class="line">        for(var i=0;i&lt;pageNum;i++)&#123;</span><br><span class="line">            var span = document.createElement(&quot;span&quot;);</span><br><span class="line">            span.innerHTML = i+1;</span><br><span class="line">            //5.拿到返回的当前页码-1，把当前索引设置高亮</span><br><span class="line">            var curidx = res.curpage -1;</span><br><span class="line">            if(i == curidx)&#123;span.className = &quot;active&quot;;&#125;</span><br><span class="line">            page.appendChild(span);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">xhr.open(&apos;get&apos;,&apos;../api/lemon.php?qty=&apos;+qty+&apos;&amp;curpage=1&apos;,true);</span><br><span class="line">xhr.send();</span><br><span class="line">// 4.点击分页切换</span><br><span class="line">page.onclick = function(e)&#123;</span><br><span class="line">    if(e.target.tagName.toLowerCase() === &apos;span&apos;)&#123;</span><br><span class="line">        let curpage = e.target.innerText;</span><br><span class="line">        xhr.open(&apos;get&apos;,&apos;../api/lemon.php?qty=&apos;+qty+&apos;&amp;curpage=&apos;+curpage,true);</span><br><span class="line">        xhr.send();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">//php：</span><br><span class="line">&lt;?php</span><br><span class="line">    $qty = isset($_GET[&quot;qty&quot;])? $_GET[&quot;qty&quot;] : 5;</span><br><span class="line">    $curpage = isset($_GET[&quot;curpage&quot;])? $_GET[&quot;curpage&quot;] : 1;</span><br><span class="line">    //1.拿到json数据,根据每页数量与当前页，裁切对应的数据</span><br><span class="line">    $path = &apos;../data/football.json&apos;;</span><br><span class="line">    $file = fopen($path,&apos;r&apos;);</span><br><span class="line">    $content = fread($file,filesize($path));</span><br><span class="line">    $data = json_decode($content);</span><br><span class="line">    $curdate = array_slice($data,$qty*($curpage-1),$qty);</span><br><span class="line">    //2.格式化数据，再返回给前端</span><br><span class="line">    $res = array(</span><br><span class="line">        &quot;total&quot; =&gt; count($data),</span><br><span class="line">        &quot;data&quot; =&gt; $curdate,</span><br><span class="line">        &quot;qty&quot; =&gt; $qty*1,</span><br><span class="line">        &quot;curpage&quot; =&gt; $curpage*1,</span><br><span class="line">    );</span><br><span class="line">    echo json_encode($res,JSON_UNESCAPED_UNICODE);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<h2 id="ajax跨域解决方案"><a href="#ajax跨域解决方案" class="headerlink" title="ajax跨域解决方案"></a>ajax跨域解决方案</h2><h3 id="JSONP"><a href="#JSONP" class="headerlink" title="JSONP"></a>JSONP</h3><ul>
<li>JSONP 是JSON with padding（填充式JSON 或参数式JSON）的简写。</li>
<li>JSONP是一种可以绕过浏览器的安全限制，从不同的域请求数据的方法。</li>
<li>JSONP请求不是ajax请求，是利用script标签能加载其他域名的js文件的原理，来实现跨域数据的请求 </li>
<li>局限性：<ul>
<li>只能为get请求</li>
<li>接口必须有回调函数的执行</li>
</ul>
</li>
</ul>
<h6 id="演示：使用script标签其他js文件调用本地js的某个函数"><a href="#演示：使用script标签其他js文件调用本地js的某个函数" class="headerlink" title="演示：使用script标签其他js文件调用本地js的某个函数"></a>演示：使用script标签其他js文件调用本地js的某个函数</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">//html页面：</span><br><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">    function sum(n)&#123;</span><br><span class="line">        console.log(n);</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;../js/common.js&quot;&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">//common.js代码</span><br><span class="line">sum(6666);</span><br><span class="line"></span><br><span class="line">//此时html页面的控制台打印 6666。</span><br></pre></td></tr></table></figure>
<h6 id="演示：使用script标签其他php文件调用本地js的未知名方法，返回数据"><a href="#演示：使用script标签其他php文件调用本地js的未知名方法，返回数据" class="headerlink" title="演示：使用script标签其他php文件调用本地js的未知名方法，返回数据"></a>演示：使用script标签其他php文件调用本地js的未知名方法，返回数据</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">//html页面：</span><br><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">    function sum(data)&#123;</span><br><span class="line">        console.log(data);</span><br><span class="line">    &#125;</span><br><span class="line">    function sum2(data)&#123;</span><br><span class="line">        alert(data);</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;script src=&quot;../api/lemon.php?callback=函数名&quot;&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">//php文件：</span><br><span class="line">&lt;?php</span><br><span class="line">    $fn = $_GET[&quot;callback&quot;];</span><br><span class="line">    echo &quot;$fn(数据)&quot;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<h6 id="案例：利用JSONP原理调用百度建议"><a href="#案例：利用JSONP原理调用百度建议" class="headerlink" title="案例：利用JSONP原理调用百度建议"></a>案例：利用JSONP原理调用百度建议</h6><pre><code>msg.oninput = function(){
    let _msg = msg.value;
    clearTimeout(timer);
    timer = setTimeout(()=&gt;{
    let script = document.createElement(&apos;script&apos;);
    script.src=&apos;https://sp0.baidu.com/5a1Fazu8AA54nxGko9WTAnF6hhy/sujson=1&amp;cb=getData&amp;wd=&apos;+_msg;
    document.body.appendChild(script);
    },500);
}
window.getData = function(data){
    suggest.innerHTML = data.s.map(item=&gt;{
        return `&lt;li&gt;${item}&lt;/li&gt;`
        }).join(&quot;&quot;);
    }
})
//原理性代码：
//1.script的src中回调函数的传递
script.src=&apos;https://sp0.baidu.com/5a1Fazu8AA54nxGko9WTAnF6hhy/sujson=1&amp;cb=getData&amp;wd=&apos;+_msg;
//2.声明全局函数
window.getData = function(data){处理数据}
</code></pre><h3 id="CORS"><a href="#CORS" class="headerlink" title="CORS"></a>CORS</h3><p>CORS是一个W3C标准，全称是”跨域资源共享”（Cross-origin resource sharing），它允许浏览器向跨源服务器发出XMLHttpRequest请求，从而克服了AJAX只能同源使用的限制。</p>
<p>CORS需要浏览器和服务器同时支持。目前，所有浏览器都支持该功能，IE浏览器不能低于IE10。</p>
<pre><code>1.Access-Control-Allow-Origin
    header(&apos;Access-Control-Allow-Origin: * &apos;);  
该字段是必须的。需要在后端响应头添加词字段，值要么是一个*，表示接受任意域名的请求，要么指定一个域名http://localhost。
2.Access-Control-Allow-Methods
3.Access-Control-Allow-Headers
    header(&apos;Access-Control-Allow-Methods:POST&apos;);  
    header(&apos;Access-Control-Allow-Headers:x-requested-with,content-type&apos;); 
</code></pre><h6 id="案例：天气预报"><a href="#案例：天气预报" class="headerlink" title="案例：天气预报"></a>案例：天气预报</h6><pre><code>//1.直接利用ajax请求得到数据
let xhr = new XMLHttpRequest();
let status = [200,304]
xhr.onload = function(){
    if(status.includes(xhr.status)){
        let res = JSON.parse(xhr.responseText)
        console.log(res.data);
        //拿到数据，可以渲染部分到页面上
        let title = document.createElement(&apos;h2&apos;);
        title.innerHTML = res.data.city + &apos;天气预报&apos;;
        let tips = document.createElement(&apos;p&apos;);
        tips.innerHTML = res.data.ganmao;
        let ul = document.createElement(&apos;ul&apos;);
        ul.innerHTML = res.data.forecast.map(item=&gt;{
            return `&lt;li&gt;
                &lt;h4&gt;${item.date}&lt;/h4&gt;
                &lt;p&gt;${item.low} / ${item.high}&lt;/p&gt;
                &lt;p class=&quot;type&quot;&gt;${item.type}&lt;/p&gt;
            &lt;/li&gt;`
        }).join(&apos;\n&apos;);
        // 清空内容
        weather.innerHTML = &apos;&apos;;
        weather.appendChild(title);
        weather.appendChild(tips);
        weather.appendChild(ul);
    }
}
xhr.open(&apos;get&apos;,&apos;http://wthrcdn.etouch.cn/weather_mini?city=广州&apos;,true);
xhr.send();
//2.配合文本框实现，得到不同城市的天气预报
city.onblur = function(){
    let _city = city.value.trim();
    if(_city.length === 0){
        return;
    }
    xhr.open(&apos;get&apos;,&apos;http://wthrcdn.etouch.cn/weather_mini?city=&apos;+_city,true);
    xhr.send();
}
</code></pre><h6 id="演示：百度地图"><a href="#演示：百度地图" class="headerlink" title="演示：百度地图"></a>演示：百度地图</h6><h3 id="服务器代理"><a href="#服务器代理" class="headerlink" title="服务器代理"></a>服务器代理</h3><p>后端不存在跨域问题，所以可以利用后端间接获取其他网站的数据</p>
<h5 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h5><p>Promise是一个构造函数，所谓的Promise对象，就是通过new Promise()实例化得到的对象，用来传递异步操作的消息。它代表了某个未来才会知道结果的事件（通常是一个异步操作），并且这个事件提供统一的 API，可供进一步处理。           </p>
<h5 id="Promise-的三种状态"><a href="#Promise-的三种状态" class="headerlink" title="Promise 的三种状态"></a>Promise 的三种状态</h5><p>Pending（未完成）可以理解为Promise对象实例创建时候的初始状态<br>Resolved（成功） 可以理解为成功的状态<br>Rejected（失败） 可以理解为失败的状态</p>

      
    </div>
    
    
    

    <div>
        
            
        
    </div>
    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/js/" rel="tag"># JS</a>
          
            <a href="/tags/ajax/" rel="tag"># AJAX</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/05/19/JS基础/记/" rel="next" title="js简介(一些面试问题、无答案)">
                <i class="fa fa-chevron-left"></i> js简介(一些面试问题、无答案)
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/05/19/JS基础/php、ajax/02.php/" rel="prev" title="PHP简介">
                PHP简介 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/favicon.png" alt="Admin">
            
              <p class="site-author-name" itemprop="name">Admin</p>
              <p class="site-description motion-element" itemprop="description">我有一壶酒足以慰风尘，尽倾江海里，共饮天下人!</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">66</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">8</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">12</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/462937186" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Ajax"><span class="nav-number">1.</span> <span class="nav-text">Ajax</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#了解AJAX"><span class="nav-number">1.1.</span> <span class="nav-text">了解AJAX</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#json"><span class="nav-number">1.2.</span> <span class="nav-text">json</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#json数据-json字符串"><span class="nav-number">1.2.0.1.</span> <span class="nav-text">json数据(json字符串)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#json字符串与对象的转换"><span class="nav-number">1.2.0.2.</span> <span class="nav-text">json字符串与对象的转换</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#了解json文件存在的意义"><span class="nav-number">1.2.0.3.</span> <span class="nav-text">了解json文件存在的意义</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Ajax请求步骤"><span class="nav-number">1.3.</span> <span class="nav-text">Ajax请求步骤</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#创建请求对象-返回一个异步请求对象"><span class="nav-number">1.3.0.1.</span> <span class="nav-text">创建请求对象,返回一个异步请求对象</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#处理服务器返回数据"><span class="nav-number">1.3.0.2.</span> <span class="nav-text">处理服务器返回数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#设置请求参数，建立与服务器连接"><span class="nav-number">1.3.0.3.</span> <span class="nav-text">设置请求参数，建立与服务器连接</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#向服务器发送请求"><span class="nav-number">1.3.0.4.</span> <span class="nav-text">向服务器发送请求</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#案例：演示向goodslist-json请求数据"><span class="nav-number">1.3.0.4.0.1.</span> <span class="nav-text">案例：演示向goodslist.json请求数据</span></a></li></ol></li></ol></li></ol><li class="nav-item nav-level-2"><a class="nav-link" href="#XMLHttpRequest对象属性方法"><span class="nav-number">1.4.</span> <span class="nav-text">XMLHttpRequest对象属性方法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#open-type-url（同源策略）-async（同步、异步）"><span class="nav-number">1.4.0.1.</span> <span class="nav-text">open(type,url（同源策略）,async（同步、异步）)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#send-data"><span class="nav-number">1.4.0.2.</span> <span class="nav-text">send(data)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#readyState"><span class="nav-number">1.4.0.3.</span> <span class="nav-text">readyState</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#responseText"><span class="nav-number">1.4.0.4.</span> <span class="nav-text">responseText</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#status"><span class="nav-number">1.4.0.5.</span> <span class="nav-text">status</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#php本地数据操作"><span class="nav-number">2.</span> <span class="nav-text">php本地数据操作</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#获取前端数据"><span class="nav-number">2.0.0.1.</span> <span class="nav-text">获取前端数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#文件的读取与写入"><span class="nav-number">2.0.0.2.</span> <span class="nav-text">文件的读取与写入</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#fopen-path-mode-：打开文件"><span class="nav-number">2.0.0.2.1.</span> <span class="nav-text">fopen(path,mode)：打开文件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#fread-file-length-：读取内容"><span class="nav-number">2.0.0.2.2.</span> <span class="nav-text">fread(file,length)：读取内容</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#fwrite-file-json字符串-：写入内容"><span class="nav-number">2.0.0.2.3.</span> <span class="nav-text">fwrite(file,json字符串)：写入内容</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#fclose-file-：关闭文件-避免资源占用"><span class="nav-number">2.0.0.2.4.</span> <span class="nav-text">fclose(file)：关闭文件,避免资源占用</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#filesize-path-：读取文件字符长度"><span class="nav-number">2.0.0.2.5.</span> <span class="nav-text">filesize(path)：读取文件字符长度</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#案例：微博点赞"><span class="nav-number">2.0.0.2.5.1.</span> <span class="nav-text">案例：微博点赞</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#补充：eval的使用"><span class="nav-number">2.0.0.2.5.2.</span> <span class="nav-text">补充：eval的使用</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#讲解：ajax的来历及同源策略、同步异步"><span class="nav-number">2.0.0.2.5.3.</span> <span class="nav-text">讲解：ajax的来历及同源策略、同步异步</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#案例：用户名验证"><span class="nav-number">2.0.0.2.5.4.</span> <span class="nav-text">案例：用户名验证</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#案例：分页数据加载"><span class="nav-number">2.0.0.2.5.5.</span> <span class="nav-text">案例：分页数据加载</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ajax跨域解决方案"><span class="nav-number">2.1.</span> <span class="nav-text">ajax跨域解决方案</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#JSONP"><span class="nav-number">2.1.1.</span> <span class="nav-text">JSONP</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#演示：使用script标签其他js文件调用本地js的某个函数"><span class="nav-number">2.1.1.0.0.1.</span> <span class="nav-text">演示：使用script标签其他js文件调用本地js的某个函数</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#演示：使用script标签其他php文件调用本地js的未知名方法，返回数据"><span class="nav-number">2.1.1.0.0.2.</span> <span class="nav-text">演示：使用script标签其他php文件调用本地js的未知名方法，返回数据</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#案例：利用JSONP原理调用百度建议"><span class="nav-number">2.1.1.0.0.3.</span> <span class="nav-text">案例：利用JSONP原理调用百度建议</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CORS"><span class="nav-number">2.1.2.</span> <span class="nav-text">CORS</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#案例：天气预报"><span class="nav-number">2.1.2.0.0.1.</span> <span class="nav-text">案例：天气预报</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#演示：百度地图"><span class="nav-number">2.1.2.0.0.2.</span> <span class="nav-text">演示：百度地图</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#服务器代理"><span class="nav-number">2.1.3.</span> <span class="nav-text">服务器代理</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Promise"><span class="nav-number">2.1.3.0.1.</span> <span class="nav-text">Promise</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Promise-的三种状态"><span class="nav-number">2.1.3.0.2.</span> <span class="nav-text">Promise 的三种状态</span></a></li></ol></li></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Admin</span>

  
</div>









        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
